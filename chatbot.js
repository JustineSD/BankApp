var inst = null;

var sayQueue = [];

var utterComplete = true;

var audioicons = null;


var micon = false;

var speakeron = false;

var stream = null;

var freezeClick = false;

var audio = null;

var lang = {

'es-US_SofiaVoice':'spanish',

'de-DE_BirgitVoice':'german',

'it-IT_FrancescaV3Voice':'italian',

'fr-FR_ReneeV3Voice':'french',

'ja-JP_EmiVoice':'japanese',

'ko-KR_SiWooVoice':'korean',

'pt-BR_IsabelaVoice':'portuguese',

'en-US_EmilyV3Voice':'english'

}

var lmodel = {

'es-ES_Telephony':'spanish',

'de-DE_Telephony':'german',

'it-IT_Telephony':'italian',

'fr-FR_Telephony':'french',

'ja-JP_NarrowbandModel':'japanese',

'ko-KR_NarrowbandModel':'korean',

'pt-BR_Telephony':'portuguese',

'en-US_ShortForm_NarrowbandModel':'english'

}

function fLang(flang) {

    if("en-US_EmilyV3Voice" != "undefined")

        return "en-US_EmilyV3Voice";

    return Object.entries(lang).find(([key, val]) => flang == key.substring(0, 2))[0];

}

function fModel(flang) {

    if("en-US_ShortForm_NarrowbandModel" != "undefined")

        return "en-US_ShortForm_NarrowbandModel";

    return Object.entries(lmodel).find(([key, val]) => flang == key.substring(0, 2))[0];

}

// fetch('https://api.us-south.text-to-speech.watson.cloud.ibm.com/instances/73090c34-4a09-4dc2-aec7-e4ce7aa1aedb',{
//     method: "POST",
//     headers: {
//         apikey: '81cGXOQUS8j0uumUWq4Op8H2aZVnVjFDc9paCTPTeJIG'
//     }
// }).then(res => res.json()).then(data => ttstoken = data);

// fetch('https://api.us-south.speech-to-text.watson.cloud.ibm.com/instances/40e5e21e-85f0-4cf1-bb41-c3dc955fe1ac',{
//     method: "POST",
//     headers: {
//         apikey: 'ou0RHXeR4UAGWKCqvPWk7j182Ek-39zzctUoXOJbb7iw'
//     }
//     }).then(res => res.json()).then(data => stttoken = data);
const TextToSpeechV1 = require('ibm-watson/text-to-speech/v1');
const SpeechToTextV1 = require('ibm-watson/speech-to-text/v1');
const { IamAuthenticator } = require('ibm-watson/auth');



const ttstoken = new TextToSpeechV1({
  authenticator: new IamAuthenticator({
    apikey: '81cGXOQUS8j0uumUWq4Op8H2aZVnVjFDc9paCTPTeJIG',
  }),
  serviceUrl: 'https://api.us-south.text-to-speech.watson.cloud.ibm.com/instances/73090c34-4a09-4dc2-aec7-e4ce7aa1aedb',
});

const stttoken = new SpeechToTextV1({
  authenticator: new IamAuthenticator({
    apikey: 'ou0RHXeR4UAGWKCqvPWk7j182Ek-39zzctUoXOJbb7iw',
  }),
  serviceUrl: 'https://api.us-south.speech-to-text.watson.cloud.ibm.com/instances/40e5e21e-85f0-4cf1-bb41-c3dc955fe1ac',
});
// const ttstoken = "eyJraWQiOiIyMDIxMDcxOTE4MzciLCJhbGciOiJSUzI1NiJ9.eyJpYW1faWQiOiJpYW0tU2VydmljZUlkLWI3ZjEzODE5LTA0MWItNDAwYi1iOGZmLTE1OTRkYjgyZTVmNCIsImlkIjoiaWFtLVNlcnZpY2VJZC1iN2YxMzgxOS0wNDFiLTQwMGItYjhmZi0xNTk0ZGI4MmU1ZjQiLCJyZWFsbWlkIjoiaWFtIiwianRpIjoiODk4NzlmOTQtYzY0Mi00OGE4LTljYzEtOWE2N2IwYTY3NTMwIiwiaWRlbnRpZmllciI6IlNlcnZpY2VJZC1iN2YxMzgxOS0wNDFiLTQwMGItYjhmZi0xNTk0ZGI4MmU1ZjQiLCJuYW1lIjoiQXV0by1nZW5lcmF0ZWQgc2VydmljZSBjcmVkZW50aWFscyIsInN1YiI6IlNlcnZpY2VJZC1iN2YxMzgxOS0wNDFiLTQwMGItYjhmZi0xNTk0ZGI4MmU1ZjQiLCJzdWJfdHlwZSI6IlNlcnZpY2VJZCIsInVuaXF1ZV9pbnN0YW5jZV9jcm5zIjpbImNybjp2MTpibHVlbWl4OnB1YmxpYzp0ZXh0LXRvLXNwZWVjaDp1cy1zb3V0aDphLzU3MTlkYjkzNDZjZTQzNGE4YWViM2Q0N2E3YmI3YjIyOjczMDkwYzM0LTRhMDktNGRjMi1hZWM3LWU0Y2U3YWExYWVkYjo6Il0sImF1dGhuIjp7InN1YiI6IlNlcnZpY2VJZC1iN2YxMzgxOS0wNDFiLTQwMGItYjhmZi0xNTk0ZGI4MmU1ZjQiLCJpYW1faWQiOiJpYW0tU2VydmljZUlkLWI3ZjEzODE5LTA0MWItNDAwYi1iOGZmLTE1OTRkYjgyZTVmNCIsInN1Yl90eXBlIjoiU2VydmljZUlkIiwibmFtZSI6IkF1dG8tZ2VuZXJhdGVkIHNlcnZpY2UgY3JlZGVudGlhbHMifSwiYWNjb3VudCI6eyJib3VuZGFyeSI6Imdsb2JhbCIsInZhbGlkIjp0cnVlLCJic3MiOiI1NzE5ZGI5MzQ2Y2U0MzRhOGFlYjNkNDdhN2JiN2IyMiIsImZyb3plbiI6dHJ1ZX0sImlhdCI6MTYyNzY3MDA4OSwiZXhwIjoxNjI3NjczNjg5LCJpc3MiOiJodHRwczovL2lhbS5ibHVlbWl4Lm5ldC9pZGVudGl0eSIsImdyYW50X3R5cGUiOiJ1cm46aWJtOnBhcmFtczpvYXV0aDpncmFudC10eXBlOmFwaWtleSIsInNjb3BlIjoiaWJtIG9wZW5pZCIsImNsaWVudF9pZCI6ImRlZmF1bHQiLCJhY3IiOjEsImFtciI6WyJwd2QiXX0.nT988PrUpEp_lVkYfndX6MqbeIETp5K7sk8Jqw8jBhQFxbrWLWOmqrWx8z_aeBGSUp9PSjMcGdsL7KpynpDJfYl7oEMy_6fhG-yHvY8A0NWRFuiNSsfB7vVX62qmtQ_DDthJlEr_hp8UxwpA2HlyZDTbdgf9QCNL-xsXebbggm16wsAk3BpH_KVyVNi9tcm1-dkR-gC-MlxGtzdgAb0pqZZqWEuU2IlMqT9Vy1_4G4pkP3hTZ-Q5hVsMDTadRZagISHrXsR386EXyea7Dr_SdnSJwg-FGghBjQ8cLeiemHbhV8pXRTjsySXmzUmU0xPxhXV1k9nHPEo6pxufh6_Icw";
// const stttoken = "eyJraWQiOiIyMDIxMDcxOTE4MzciLCJhbGciOiJSUzI1NiJ9.eyJpYW1faWQiOiJpYW0tU2VydmljZUlkLWNkYmNmNTc0LWFhMzctNGRjZS04NWQxLTgzMGQwMzA0N2Q2MCIsImlkIjoiaWFtLVNlcnZpY2VJZC1jZGJjZjU3NC1hYTM3LTRkY2UtODVkMS04MzBkMDMwNDdkNjAiLCJyZWFsbWlkIjoiaWFtIiwianRpIjoiYTY5N2M2OWItNzg3ZS00YWIwLTkyZjctNzQ4ZDVkODQ3OTEzIiwiaWRlbnRpZmllciI6IlNlcnZpY2VJZC1jZGJjZjU3NC1hYTM3LTRkY2UtODVkMS04MzBkMDMwNDdkNjAiLCJuYW1lIjoiQXV0by1nZW5lcmF0ZWQgc2VydmljZSBjcmVkZW50aWFscyIsInN1YiI6IlNlcnZpY2VJZC1jZGJjZjU3NC1hYTM3LTRkY2UtODVkMS04MzBkMDMwNDdkNjAiLCJzdWJfdHlwZSI6IlNlcnZpY2VJZCIsInVuaXF1ZV9pbnN0YW5jZV9jcm5zIjpbImNybjp2MTpibHVlbWl4OnB1YmxpYzpzcGVlY2gtdG8tdGV4dDp1cy1zb3V0aDphLzU3MTlkYjkzNDZjZTQzNGE4YWViM2Q0N2E3YmI3YjIyOjQwZTVlMjFlLTg1ZjAtNGNmMS1iYjQxLWMzZGM5NTVmZTFhYzo6Il0sImF1dGhuIjp7InN1YiI6IlNlcnZpY2VJZC1jZGJjZjU3NC1hYTM3LTRkY2UtODVkMS04MzBkMDMwNDdkNjAiLCJpYW1faWQiOiJpYW0tU2VydmljZUlkLWNkYmNmNTc0LWFhMzctNGRjZS04NWQxLTgzMGQwMzA0N2Q2MCIsInN1Yl90eXBlIjoiU2VydmljZUlkIiwibmFtZSI6IkF1dG8tZ2VuZXJhdGVkIHNlcnZpY2UgY3JlZGVudGlhbHMifSwiYWNjb3VudCI6eyJib3VuZGFyeSI6Imdsb2JhbCIsInZhbGlkIjp0cnVlLCJic3MiOiI1NzE5ZGI5MzQ2Y2U0MzRhOGFlYjNkNDdhN2JiN2IyMiIsImZyb3plbiI6dHJ1ZX0sImlhdCI6MTYyNzY2OTQzNiwiZXhwIjoxNjI3NjczMDM2LCJpc3MiOiJodHRwczovL2lhbS5uZy5ibHVlbWl4Lm5ldC9vaWRjL3Rva2VuIiwiZ3JhbnRfdHlwZSI6InVybjppYm06cGFyYW1zOm9hdXRoOmdyYW50LXR5cGU6YXBpa2V5Iiwic2NvcGUiOiJpYm0gb3BlbmlkIiwiY2xpZW50X2lkIjoiZGVmYXVsdCIsImFjciI6MSwiYW1yIjpbInB3ZCJdfQ.NYOrOkdaya91WkXLvo2o6_cbitT7vJEdCf9S0qk4CJSvYPAKeevfiLB4B4jhQcxJzO9-lsrruObI1CEFITZ9K5h81EkeZKG6rFxiqw6Dfx055mWdFiDGBKQLF9kIh7OVL2AhlkRrSpZfnkimqpt6qyUkKg3zPWIbbAuvZGBmTMK9ZZW6Cmwtn3wkyMEG2mE3oxIciC9wcfbfVYIhNQk2aw0ij1k4Bo0HLecAGy99yDFl4NPbzO0F7pTiI-oMT0s4Zy4zyFVc3p0cpABPOwx29-VbURkL85Y_-9Ip_fpqXIX2i4V_hrt2FSUeQS_GaP0ZCSsgK_jCSo2nKv3rmqvzMA";
setInterval(function(){

    if (sayQueue.length){

        if (utterComplete){

            utterComplete = false;

            element = sayQueue.shift();

            const myAudio = WatsonSpeech.TextToSpeech.synthesize(Object.assign(ttstoken, {text: element.text, voice: element.lvoice}))
-
                myAudio.addEventListener("ended", function(){

                myAudio.currentTime = 0;

                utterComplete = true;

            });

        }

    }

}, 100);

 

var speakerhandler = function () {

    if(speakeron){

        $('#WAC__speaker-button').html('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(2.06405 0 0 2.06405 128 0)"  d="M339.642 235.684L288.842 184.484L339.642 133.684C 342.842 130.484 342.842 125.684 339.642 122.484C 336.442 119.284 331.642 119.284 328.442 122.484L328.442 122.484L277.642 173.284L226.442 122.484C 223.242 119.284 218.442 119.284 215.242 122.484C 212.042 125.684 212.042 130.484 215.242 133.684L215.242 133.684L266.042 184.484L215.242 235.684C 212.042 238.884 212.042 243.684 215.242 246.884C 216.842 248.484 218.842 249.284 220.842 249.284C 222.842 249.284 224.842 248.484 226.442 246.884L226.442 246.884L277.642 196.084L328.442 246.884C 330.042 248.484 332.042 249.284 334.042 249.284C 336.042 249.284 338.042 248.484 339.642 246.884C 342.842 243.684 342.842 238.884 339.642 235.684z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(2.06405 0 0 2.06405 128 0)"  d="M278.042 232.084C 273.642 232.084 270.042 235.684 270.042 240.084L270.042 240.084L270.042 356.084L142.042 259.284C 141.642 255.284 138.442 252.084 134.042 252.084C 129.642 252.084 126.042 255.684 126.042 260.084C 126.042 264.484 122.442 268.084 118.042 268.084L118.042 268.084L70.04199 268.084C 56.84199 268.084 46.04199 257.284 46.04199 244.084L46.04199 244.084L46.04199 132.084C 46.04199 118.884 56.84199 108.084 70.04199 108.084L70.04199 108.084L118.042 108.084C 122.442 108.084 126.042 111.684 126.042 116.084C 126.042 120.484 129.642 124.084 134.042 124.084C 138.442 124.084 142.042 120.484 142.042 116.084C 142.042 115.284 142.042 114.084 142.042 113.284L142.042 113.284L270.042 16.08398L270.042 136.084C 270.042 140.484 273.642 144.084 278.042 144.084C 282.442 144.084 286.042 140.484 286.042 136.084L286.042 136.084L286.042 16.08398C 286.042 10.08398 282.442 4.483984 277.242 1.683985C 271.642 -1.116015 265.242 -0.3160152 260.442 3.283985L260.442 3.283985L134.442 98.88398C 130.042 94.88398 124.442 92.08398 118.042 92.08398L118.042 92.08398L70.04202 92.08398C 48.04202 92.08398 30.04202 110.084 30.04202 132.084L30.04202 132.084L30.04202 244.084C 30.04202 266.084 48.04202 284.084 70.04202 284.084L70.04202 284.084L118.042 284.084C 125.642 284.084 132.042 280.884 136.442 275.284L136.442 275.284L260.442 368.884C 263.242 371.284 266.842 372.084 270.042 372.084C 272.442 372.084 274.842 371.684 277.242 370.484C 282.842 367.684 286.042 362.084 286.042 356.084L286.042 356.084L286.042 240.084C 286.042 235.684 282.442 232.084 278.042 232.084z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg>');

        $('#WAC__speaker-button-agent').html('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(2.06405 0 0 2.06405 128 0)"  d="M339.642 235.684L288.842 184.484L339.642 133.684C 342.842 130.484 342.842 125.684 339.642 122.484C 336.442 119.284 331.642 119.284 328.442 122.484L328.442 122.484L277.642 173.284L226.442 122.484C 223.242 119.284 218.442 119.284 215.242 122.484C 212.042 125.684 212.042 130.484 215.242 133.684L215.242 133.684L266.042 184.484L215.242 235.684C 212.042 238.884 212.042 243.684 215.242 246.884C 216.842 248.484 218.842 249.284 220.842 249.284C 222.842 249.284 224.842 248.484 226.442 246.884L226.442 246.884L277.642 196.084L328.442 246.884C 330.042 248.484 332.042 249.284 334.042 249.284C 336.042 249.284 338.042 248.484 339.642 246.884C 342.842 243.684 342.842 238.884 339.642 235.684z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(2.06405 0 0 2.06405 128 0)"  d="M278.042 232.084C 273.642 232.084 270.042 235.684 270.042 240.084L270.042 240.084L270.042 356.084L142.042 259.284C 141.642 255.284 138.442 252.084 134.042 252.084C 129.642 252.084 126.042 255.684 126.042 260.084C 126.042 264.484 122.442 268.084 118.042 268.084L118.042 268.084L70.04199 268.084C 56.84199 268.084 46.04199 257.284 46.04199 244.084L46.04199 244.084L46.04199 132.084C 46.04199 118.884 56.84199 108.084 70.04199 108.084L70.04199 108.084L118.042 108.084C 122.442 108.084 126.042 111.684 126.042 116.084C 126.042 120.484 129.642 124.084 134.042 124.084C 138.442 124.084 142.042 120.484 142.042 116.084C 142.042 115.284 142.042 114.084 142.042 113.284L142.042 113.284L270.042 16.08398L270.042 136.084C 270.042 140.484 273.642 144.084 278.042 144.084C 282.442 144.084 286.042 140.484 286.042 136.084L286.042 136.084L286.042 16.08398C 286.042 10.08398 282.442 4.483984 277.242 1.683985C 271.642 -1.116015 265.242 -0.3160152 260.442 3.283985L260.442 3.283985L134.442 98.88398C 130.042 94.88398 124.442 92.08398 118.042 92.08398L118.042 92.08398L70.04202 92.08398C 48.04202 92.08398 30.04202 110.084 30.04202 132.084L30.04202 132.084L30.04202 244.084C 30.04202 266.084 48.04202 284.084 70.04202 284.084L70.04202 284.084L118.042 284.084C 125.642 284.084 132.042 280.884 136.442 275.284L136.442 275.284L260.442 368.884C 263.242 371.284 266.842 372.084 270.042 372.084C 272.442 372.084 274.842 371.684 277.242 370.484C 282.842 367.684 286.042 362.084 286.042 356.084L286.042 356.084L286.042 240.084C 286.042 235.684 282.442 232.084 278.042 232.084z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg>');

    }else{

        $('#WAC__speaker-button').html('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(1.918082 0 0 1.918082 128 0)"  d="M349.6 84.242C 346.4 81.44199 341.2 81.44199 338.4 84.642C 335.6 87.842 335.6 93.042 338.8 95.842C 367.6 122.242 384.4 160.242 384.4 199.842C 384.4 239.842 368.4 276.642 338.8 303.842C 335.6 307.042 335.2 311.842 338.4 315.042C 340 316.642 342 317.442 344.4 317.442C 346.4 317.442 348.4 316.642 350 315.442C 382.4 285.042 400.4 243.842 400.4 199.442C 400 156.242 381.6 113.842 349.6 84.242z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.918082 0 0 1.918082 128 0)"  d="M326 129.442C 323.2 126.242 318 125.442 314.8 128.642C 311.6 131.442 310.8 136.642 314 139.842C 328 156.642 336 178.242 336 200.242C 336 222.242 328 243.842 314 260.642C 311.2 263.842 311.6 269.042 314.8 271.842C 316.4 273.042 318 273.842 320 273.842C 322.4 273.842 324.4 273.042 326 271.042C 342.8 251.042 352 226.242 352 200.242C 352 174.642 342.8 149.442 326 129.442z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.918082 0 0 1.918082 128 0)"  d="M284 163.842C 280 166.242 278.8 171.042 281.2 174.642C 285.6 182.242 288 191.042 288 200.242C 288 209.442 285.6 217.842 281.2 225.842C 278.8 229.842 280.4 234.642 284 236.642C 285.2 237.442 286.8 237.842 288 237.842C 290.8 237.842 293.6 236.242 294.8 233.842C 300.8 223.442 304 212.242 304 200.242C 304 188.242 300.8 176.642 294.8 166.642C 292.8 162.642 287.6 161.442 284 163.842z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.918082 0 0 1.918082 128 0)"  d="M104 210.242C 99.6 210.242 96 213.842 96 218.242L96 218.242L96 230.242C 96 234.642 99.6 238.242 104 238.242C 108.4 238.242 112 234.642 112 230.242L112 230.242L112 218.242C 112 213.842 108.4 210.242 104 210.242z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.918082 0 0 1.918082 128 0)"  d="M247.2 15.842C 241.6 13.042 235.2 13.842 230.4 17.442L230.4 17.442L104.4 112.642C 99.99999 108.642 94.39999 106.242 87.99999 106.242L87.99999 106.242L40 106.242C 18 106.242 0 124.242 0 146.242L0 146.242L0 258.242C 0 280.242 18 298.242 40 298.242L40 298.242L88 298.242C 95.6 298.242 102.4 294.642 106.8 289.442L106.8 289.442L230.4 383.042C 233.2 385.442 236.8 386.242 240 386.242C 242.4 386.242 244.8 385.842 247.2 384.642C 252.8 381.842 256 376.242 256 370.242L256 370.242L256 30.24203C 256 24.242 252.4 18.642 247.2 15.842zM240 370.242L112 273.442C 111.6 269.442 108 266.242 104 266.242C 99.6 266.242 96 269.842 96 274.242C 96 278.642 92.4 282.242 88 282.242L88 282.242L40 282.242C 26.8 282.242 16 271.442 16 258.242L16 258.242L16 146.242C 16 133.042 26.8 122.242 40 122.242L40 122.242L88 122.242C 92.4 122.242 96 125.842 96 130.242L96 130.242L96 182.242C 96 186.642 99.6 190.242 104 190.242C 108.4 190.242 112 186.642 112 182.242L112 182.242L112 130.242C 112 129.042 112 128.242 111.6 127.042L111.6 127.042L240 30.242L240 370.242z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg>');

        $('#WAC__speaker-button-agent').html('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(1.918082 0 0 1.918082 128 0)"  d="M349.6 84.242C 346.4 81.44199 341.2 81.44199 338.4 84.642C 335.6 87.842 335.6 93.042 338.8 95.842C 367.6 122.242 384.4 160.242 384.4 199.842C 384.4 239.842 368.4 276.642 338.8 303.842C 335.6 307.042 335.2 311.842 338.4 315.042C 340 316.642 342 317.442 344.4 317.442C 346.4 317.442 348.4 316.642 350 315.442C 382.4 285.042 400.4 243.842 400.4 199.442C 400 156.242 381.6 113.842 349.6 84.242z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.918082 0 0 1.918082 128 0)"  d="M326 129.442C 323.2 126.242 318 125.442 314.8 128.642C 311.6 131.442 310.8 136.642 314 139.842C 328 156.642 336 178.242 336 200.242C 336 222.242 328 243.842 314 260.642C 311.2 263.842 311.6 269.042 314.8 271.842C 316.4 273.042 318 273.842 320 273.842C 322.4 273.842 324.4 273.042 326 271.042C 342.8 251.042 352 226.242 352 200.242C 352 174.642 342.8 149.442 326 129.442z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.918082 0 0 1.918082 128 0)"  d="M284 163.842C 280 166.242 278.8 171.042 281.2 174.642C 285.6 182.242 288 191.042 288 200.242C 288 209.442 285.6 217.842 281.2 225.842C 278.8 229.842 280.4 234.642 284 236.642C 285.2 237.442 286.8 237.842 288 237.842C 290.8 237.842 293.6 236.242 294.8 233.842C 300.8 223.442 304 212.242 304 200.242C 304 188.242 300.8 176.642 294.8 166.642C 292.8 162.642 287.6 161.442 284 163.842z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.918082 0 0 1.918082 128 0)"  d="M104 210.242C 99.6 210.242 96 213.842 96 218.242L96 218.242L96 230.242C 96 234.642 99.6 238.242 104 238.242C 108.4 238.242 112 234.642 112 230.242L112 230.242L112 218.242C 112 213.842 108.4 210.242 104 210.242z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.918082 0 0 1.918082 128 0)"  d="M247.2 15.842C 241.6 13.042 235.2 13.842 230.4 17.442L230.4 17.442L104.4 112.642C 99.99999 108.642 94.39999 106.242 87.99999 106.242L87.99999 106.242L40 106.242C 18 106.242 0 124.242 0 146.242L0 146.242L0 258.242C 0 280.242 18 298.242 40 298.242L40 298.242L88 298.242C 95.6 298.242 102.4 294.642 106.8 289.442L106.8 289.442L230.4 383.042C 233.2 385.442 236.8 386.242 240 386.242C 242.4 386.242 244.8 385.842 247.2 384.642C 252.8 381.842 256 376.242 256 370.242L256 370.242L256 30.24203C 256 24.242 252.4 18.642 247.2 15.842zM240 370.242L112 273.442C 111.6 269.442 108 266.242 104 266.242C 99.6 266.242 96 269.842 96 274.242C 96 278.642 92.4 282.242 88 282.242L88 282.242L40 282.242C 26.8 282.242 16 271.442 16 258.242L16 258.242L16 146.242C 16 133.042 26.8 122.242 40 122.242L40 122.242L88 122.242C 92.4 122.242 96 125.842 96 130.242L96 130.242L96 182.242C 96 186.642 99.6 190.242 104 190.242C 108.4 190.242 112 186.642 112 182.242L112 182.242L112 130.242C 112 129.042 112 128.242 111.6 127.042L111.6 127.042L240 30.242L240 370.242z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg>');

    }

    speakeron = !speakeron;

}

 

var michandler = function () {

    if(micon){

        stream.stop();

        $('#WAC__mic-button').html('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M182.467 178.2C 182.467 202.093 201.24 220.867 225.134 220.867C 249.027 220.867 267.801 202.094 267.801 178.2C 267.801 154.306 249.028 135.533 225.134 135.533C 201.24 135.533 182.467 154.307 182.467 178.2zM225.133 152.6C 239.64 152.6 250.733 163.693 250.733 178.2C 250.733 192.707 239.64 203.8 225.133 203.8C 210.626 203.8 199.533 192.707 199.533 178.2C 199.533 163.693 210.627 152.6 225.133 152.6z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M369.276 278.06C 369.799 272.861 370.2 268.19 370.2 263.533L370.2 263.533L370.2 178.2C 370.2 173.08 366.787 169.667 361.667 169.667L361.667 169.667L319 169.667L319 92.86699C 319 40.813 277.187 -1 225.133 -1C 173.079 -1 131.266 40.813 131.266 92.867L131.266 92.867L131.266 169.667L88.6 169.667C 83.48 169.667 80.067 173.08 80.067 178.2L80.067 178.2L80.067 263.533C 80.067 340.881 140.372 403.937 216.6 408.344L216.6 408.344L216.6 459.8L173.933 459.8C 150.04 459.8 131.266 478.573 131.266 502.467C 131.266 507.587 134.679 511 139.799 511L139.799 511L310.466 511C 315.586 511 318.999 507.587 318.999 502.467C 318.999 478.574 300.226 459.8 276.332 459.8L276.332 459.8L233.665 459.8L233.665 408.273C 239.55 407.836 245.366 406.968 250.997 405.814C 265.922 437.781 298.295 459.799 336.065 459.799C 388.118 459.799 429.932 417.986 429.932 365.9319C 429.933 325.589 404.812 291.402 369.276 278.06zM277.187 476.867C 288.28 476.867 297.667 483.694 301.08 493.934L301.08 493.934L150.04 493.934C 153.453 483.694 162.84 476.867 173.933 476.867L173.933 476.867L277.187 476.867zM353.133 186.733L353.133 263.533C 353.133 266.839 352.339 270.146 352.289 273.452C 349.937 273.047 347.555 272.729 345.145 272.5C 336.305 271.352 327.171 271.747 318.537 273.689C 318.509 273.694 318.48 273.7 318.452 273.705C 318.586 272.474 318.698 271.247 318.779 270.028C 318.997 267.863 318.999 265.698 318.999 263.533L318.999 263.533L318.999 186.733L353.133 186.733zM216.6 16.541L216.6 58.734C 216.6 63.854 220.013 67.267 225.133 67.267C 230.253 67.267 233.666 63.854 233.666 58.734L233.666 58.734L233.666 16.541C 272.259 20.739 301.933 53.088 301.933 92.867L301.933 92.867L259.266 92.867C 254.146 92.867 250.733 96.28 250.733 101.4C 250.733 106.52 254.146 109.933 259.266 109.933L259.266 109.933L301.933 109.933L301.933 144.066L284.866 144.066C 279.746 144.066 276.333 147.479 276.333 152.599C 276.333 157.719 279.746 161.132 284.866 161.132L284.866 161.132L301.933 161.132L301.933 178.2L301.933 195.267L284.866 195.267C 279.746 195.267 276.333 198.68 276.333 203.8C 276.333 208.92 279.746 212.333 284.866 212.333L284.866 212.333L301.933 212.333L301.933 246.466L259.266 246.466C 254.146 246.466 250.733 249.879 250.733 254.999C 250.733 260.119 254.146 263.532 259.266 263.532L259.266 263.532L301.933 263.532C 301.933 268.652 301.08 273.772 300.226 278.892C 295.774 280.821 291.508 283.04 287.445 285.519C 287.336 285.585 287.228 285.651 287.119 285.717C 286.755 285.941 286.393 286.166 286.032 286.394C 285.486 286.737 284.944 287.086 284.405 287.44C 284.369 287.464 284.333 287.487 284.297 287.511C 281.868 289.112 279.52 290.823 277.258 292.637C 263.005 303.993 252.215 319.097 246.466 336.919C 244.976 337.478 243.485 337.942 241.986 338.347C 239.213 338.957 236.44 339.442 233.666 339.781L233.666 339.781L233.666 297.6671C 233.666 292.5471 230.253 289.1341 225.133 289.1341C 220.013 289.1341 216.6 292.5471 216.6 297.6671L216.6 297.6671L216.6 339.86C 178.007 335.662 148.333 303.313 148.333 263.5341L148.333 263.5341L191 263.5341C 196.12 263.5341 199.533 260.1211 199.533 255.0011C 199.533 249.881 196.12 246.468 191 246.468L191 246.468L148.333 246.468L148.333 212.3351L165.4 212.3351C 170.52 212.3351 173.933 208.9221 173.933 203.802C 173.933 198.6821 170.52 195.269 165.4 195.269L165.4 195.269L148.333 195.269L148.333 178.2L148.333 161.133L165.4 161.133C 170.52 161.133 173.933 157.72 173.933 152.6C 173.933 147.48 170.52 144.067 165.4 144.067L165.4 144.067L148.333 144.067L148.333 109.934L191 109.934C 196.12 109.934 199.533 106.521 199.533 101.401C 199.533 96.281 196.12 92.868 191 92.868L191 92.868L148.333 92.868C 148.333 53.088 178.007 20.739 216.6 16.541zM225.133 391.533C 154.306 391.533 97.133 334.36 97.133 263.533L97.133 263.533L97.133 186.733L131.266 186.733L131.266 263.533C 131.266 315.586 173.079 357.4 225.133 357.4C 230.36 357.4 235.808 356.952 241.252 355.949C 241.75 355.879 242.248 355.808 242.746 355.737C 242.618 356.932 242.514 358.133 242.431 359.341C 242.203 361.538 242.2 363.736 242.2 365.933C 242.2 366.808 242.214 367.679 242.237 368.547C 242.249 369.003 242.271 369.465 242.289 369.925C 242.305 370.312 242.32 370.699 242.34 371.084C 242.37 371.66 242.408 372.237 242.449 372.818C 242.468 373.09 242.49 373.361 242.512 373.633C 242.559 374.222 242.608 374.811 242.668 375.402C 243.158 380.351 244.031 385.183 245.252 389.871C 238.546 390.71 231.84 391.533 225.133 391.533zM336.067 442.733C 303.559 442.733 276.023 422.908 264.745 394.601C 264.652 394.15 264.539 393.696 264.387 393.24C 262.265 387.934 260.804 382.298 260.001 376.537C 259.984 376.41 259.97 376.283 259.953 376.156C 259.82 375.166 259.705 374.173 259.611 373.177C 259.565 372.682 259.535 372.182 259.499 371.685C 259.448 371.001 259.391 370.318 259.359 369.632C 259.302 368.406 259.267 367.174 259.267 365.933C 259.267 364.761 259.303 363.598 259.354 362.44C 259.368 362.135 259.381 361.83 259.398 361.527C 259.447 360.638 259.518 359.755 259.597 358.874C 259.989 354.736 260.728 350.697 261.826 346.307C 261.884 346.076 261.914 345.859 261.956 345.636C 263.409 340.251 265.427 335.111 267.945 330.275C 275.73 315.597 288.085 303.575 303.419 296.324C 305.02 295.578 306.654 294.891 308.314 294.254C 309.032 294.254 309.749 294.254 310.467 294.254C 325.827 288.281 342.04 288.281 357.4 292.547C 358.577 292.939 359.572 293.138 360.554 293.087C 391.072 303.227 412.867 331.847 412.867 365.933C 412.867 408.6 378.733 442.733 336.067 442.733z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M378.733 323.267C 375.32 319.854 370.2 319.854 366.786 323.267L366.786 323.267L336.066 353.987L305.346 323.267C 301.933 319.854 296.813 319.854 293.399 323.267C 289.986 326.68 289.986 331.8 293.399 335.214L293.399 335.214L324.119 365.934L294.253 395.8C 290.84 399.213 290.84 404.333 294.253 407.747C 295.96 409.454 297.666 410.307 300.226 410.307C 301.933 410.307 304.493 409.454 306.199 407.747L306.199 407.747L336.066 377.88L365.933 407.747C 367.64 409.454 369.346 410.307 371.906 410.307C 374.466 410.307 377.026 409.454 377.879 407.747C 381.292 404.334 381.292 399.214 377.879 395.8L377.879 395.8L348.012 365.933L378.732 335.213C 382.147 331.8 382.147 326.68 378.733 323.267z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg>');

    }else{

        $('#WAC__mic-button').html('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M182.467 178.2C 182.467 202.093 201.24 220.867 225.134 220.867C 249.027 220.867 267.801 202.094 267.801 178.2C 267.801 154.306 249.028 135.533 225.134 135.533C 201.24 135.533 182.467 154.307 182.467 178.2zM225.133 152.6C 239.64 152.6 250.733 163.693 250.733 178.2C 250.733 192.707 239.64 203.8 225.133 203.8C 210.626 203.8 199.533 192.707 199.533 178.2C 199.533 163.693 210.627 152.6 225.133 152.6z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M369.276 278.06C 369.799 272.861 370.2 268.19 370.2 263.533L370.2 263.533L370.2 178.2C 370.2 173.08 366.787 169.667 361.667 169.667L361.667 169.667L319 169.667L319 92.86699C 319 40.813 277.187 -1 225.133 -1C 173.079 -1 131.266 40.813 131.266 92.867L131.266 92.867L131.266 169.667L88.6 169.667C 83.48 169.667 80.067 173.08 80.067 178.2L80.067 178.2L80.067 263.533C 80.067 340.881 140.372 403.937 216.6 408.344L216.6 408.344L216.6 459.8L173.933 459.8C 150.04 459.8 131.266 478.573 131.266 502.467C 131.266 507.587 134.679 511 139.799 511L139.799 511L310.466 511C 315.586 511 318.999 507.587 318.999 502.467C 318.999 478.574 300.226 459.8 276.332 459.8L276.332 459.8L233.665 459.8L233.665 408.273C 239.55 407.836 245.366 406.968 250.997 405.814C 265.922 437.781 298.295 459.799 336.065 459.799C 388.118 459.799 429.932 417.986 429.932 365.9319C 429.933 325.589 404.812 291.402 369.276 278.06zM277.187 476.867C 288.28 476.867 297.667 483.694 301.08 493.934L301.08 493.934L150.04 493.934C 153.453 483.694 162.84 476.867 173.933 476.867L173.933 476.867L277.187 476.867zM353.133 186.733L353.133 263.533C 353.133 266.839 352.339 270.146 352.289 273.452C 349.937 273.047 347.555 272.729 345.145 272.5C 336.305 271.352 327.171 271.747 318.537 273.689C 318.509 273.694 318.48 273.7 318.452 273.705C 318.586 272.474 318.698 271.247 318.779 270.028C 318.997 267.863 318.999 265.698 318.999 263.533L318.999 263.533L318.999 186.733L353.133 186.733zM216.6 16.541L216.6 58.734C 216.6 63.854 220.013 67.267 225.133 67.267C 230.253 67.267 233.666 63.854 233.666 58.734L233.666 58.734L233.666 16.541C 272.259 20.739 301.933 53.088 301.933 92.867L301.933 92.867L259.266 92.867C 254.146 92.867 250.733 96.28 250.733 101.4C 250.733 106.52 254.146 109.933 259.266 109.933L259.266 109.933L301.933 109.933L301.933 144.066L284.866 144.066C 279.746 144.066 276.333 147.479 276.333 152.599C 276.333 157.719 279.746 161.132 284.866 161.132L284.866 161.132L301.933 161.132L301.933 178.2L301.933 195.267L284.866 195.267C 279.746 195.267 276.333 198.68 276.333 203.8C 276.333 208.92 279.746 212.333 284.866 212.333L284.866 212.333L301.933 212.333L301.933 246.466L259.266 246.466C 254.146 246.466 250.733 249.879 250.733 254.999C 250.733 260.119 254.146 263.532 259.266 263.532L259.266 263.532L301.933 263.532C 301.933 268.652 301.08 273.772 300.226 278.892C 295.774 280.821 291.508 283.04 287.445 285.519C 287.336 285.585 287.228 285.651 287.119 285.717C 286.755 285.941 286.393 286.166 286.032 286.394C 285.486 286.737 284.944 287.086 284.405 287.44C 284.369 287.464 284.333 287.487 284.297 287.511C 281.868 289.112 279.52 290.823 277.258 292.637C 263.005 303.993 252.215 319.097 246.466 336.919C 244.976 337.478 243.485 337.942 241.986 338.347C 239.213 338.957 236.44 339.442 233.666 339.781L233.666 339.781L233.666 297.6671C 233.666 292.5471 230.253 289.1341 225.133 289.1341C 220.013 289.1341 216.6 292.5471 216.6 297.6671L216.6 297.6671L216.6 339.86C 178.007 335.662 148.333 303.313 148.333 263.5341L148.333 263.5341L191 263.5341C 196.12 263.5341 199.533 260.1211 199.533 255.0011C 199.533 249.881 196.12 246.468 191 246.468L191 246.468L148.333 246.468L148.333 212.3351L165.4 212.3351C 170.52 212.3351 173.933 208.9221 173.933 203.802C 173.933 198.6821 170.52 195.269 165.4 195.269L165.4 195.269L148.333 195.269L148.333 178.2L148.333 161.133L165.4 161.133C 170.52 161.133 173.933 157.72 173.933 152.6C 173.933 147.48 170.52 144.067 165.4 144.067L165.4 144.067L148.333 144.067L148.333 109.934L191 109.934C 196.12 109.934 199.533 106.521 199.533 101.401C 199.533 96.281 196.12 92.868 191 92.868L191 92.868L148.333 92.868C 148.333 53.088 178.007 20.739 216.6 16.541zM225.133 391.533C 154.306 391.533 97.133 334.36 97.133 263.533L97.133 263.533L97.133 186.733L131.266 186.733L131.266 263.533C 131.266 315.586 173.079 357.4 225.133 357.4C 230.36 357.4 235.808 356.952 241.252 355.949C 241.75 355.879 242.248 355.808 242.746 355.737C 242.618 356.932 242.514 358.133 242.431 359.341C 242.203 361.538 242.2 363.736 242.2 365.933C 242.2 366.808 242.214 367.679 242.237 368.547C 242.249 369.003 242.271 369.465 242.289 369.925C 242.305 370.312 242.32 370.699 242.34 371.084C 242.37 371.66 242.408 372.237 242.449 372.818C 242.468 373.09 242.49 373.361 242.512 373.633C 242.559 374.222 242.608 374.811 242.668 375.402C 243.158 380.351 244.031 385.183 245.252 389.871C 238.546 390.71 231.84 391.533 225.133 391.533zM336.067 442.733C 303.559 442.733 276.023 422.908 264.745 394.601C 264.652 394.15 264.539 393.696 264.387 393.24C 262.265 387.934 260.804 382.298 260.001 376.537C 259.984 376.41 259.97 376.283 259.953 376.156C 259.82 375.166 259.705 374.173 259.611 373.177C 259.565 372.682 259.535 372.182 259.499 371.685C 259.448 371.001 259.391 370.318 259.359 369.632C 259.302 368.406 259.267 367.174 259.267 365.933C 259.267 364.761 259.303 363.598 259.354 362.44C 259.368 362.135 259.381 361.83 259.398 361.527C 259.447 360.638 259.518 359.755 259.597 358.874C 259.989 354.736 260.728 350.697 261.826 346.307C 261.884 346.076 261.914 345.859 261.956 345.636C 263.409 340.251 265.427 335.111 267.945 330.275C 275.73 315.597 288.085 303.575 303.419 296.324C 305.02 295.578 306.654 294.891 308.314 294.254C 309.032 294.254 309.749 294.254 310.467 294.254C 325.827 288.281 342.04 288.281 357.4 292.547C 358.577 292.939 359.572 293.138 360.554 293.087C 391.072 303.227 412.867 331.847 412.867 365.933C 412.867 408.6 378.733 442.733 336.067 442.733z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M383 324.12C 378.733 321.56 373.613 322.413 371.053 326.68L371.053 326.68L325.656 394.776L299.373 368.493C 295.96 365.08 290.84 365.08 287.426 368.493C 284.012 371.906 284.013 377.026 287.426 380.44L287.426 380.44L319.491 412.505C 320.157 413.648 321.127 414.655 322.413 415.427C 322.507 415.474 322.6 415.52 322.694 415.567C 324.058 416.607 325.535 417.134 327.533 417.134C 330.093 417.134 331.8 416.281 333.506 414.574C 334.63 413.45 335.376 412.139 335.76 410.766L335.76 410.766L385.559 336.067C 388.12 331.8 387.267 326.68 383 324.12z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg>');

 

        stream = WatsonSpeech.SpeechToText.recognizeMicrophone(Object.assign(stttoken, {

            model: fModel("en-US_ShortForm_NarrowbandModel"),

            objectMode: false

        }));

        stream.setEncoding('utf8');

 

        stream.on('data', function(data) {

          var msg = {};

          msg.input = {};

          msg.input.text = data;

          inst.send(msg);

        });

    }

    micon = !micon;

}

 

var michandlerAgent = function () {

    if(micon){

        stream.stop();

        $('#WAC__mic-button-agent').html('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M182.467 178.2C 182.467 202.093 201.24 220.867 225.134 220.867C 249.027 220.867 267.801 202.094 267.801 178.2C 267.801 154.306 249.028 135.533 225.134 135.533C 201.24 135.533 182.467 154.307 182.467 178.2zM225.133 152.6C 239.64 152.6 250.733 163.693 250.733 178.2C 250.733 192.707 239.64 203.8 225.133 203.8C 210.626 203.8 199.533 192.707 199.533 178.2C 199.533 163.693 210.627 152.6 225.133 152.6z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M369.276 278.06C 369.799 272.861 370.2 268.19 370.2 263.533L370.2 263.533L370.2 178.2C 370.2 173.08 366.787 169.667 361.667 169.667L361.667 169.667L319 169.667L319 92.86699C 319 40.813 277.187 -1 225.133 -1C 173.079 -1 131.266 40.813 131.266 92.867L131.266 92.867L131.266 169.667L88.6 169.667C 83.48 169.667 80.067 173.08 80.067 178.2L80.067 178.2L80.067 263.533C 80.067 340.881 140.372 403.937 216.6 408.344L216.6 408.344L216.6 459.8L173.933 459.8C 150.04 459.8 131.266 478.573 131.266 502.467C 131.266 507.587 134.679 511 139.799 511L139.799 511L310.466 511C 315.586 511 318.999 507.587 318.999 502.467C 318.999 478.574 300.226 459.8 276.332 459.8L276.332 459.8L233.665 459.8L233.665 408.273C 239.55 407.836 245.366 406.968 250.997 405.814C 265.922 437.781 298.295 459.799 336.065 459.799C 388.118 459.799 429.932 417.986 429.932 365.9319C 429.933 325.589 404.812 291.402 369.276 278.06zM277.187 476.867C 288.28 476.867 297.667 483.694 301.08 493.934L301.08 493.934L150.04 493.934C 153.453 483.694 162.84 476.867 173.933 476.867L173.933 476.867L277.187 476.867zM353.133 186.733L353.133 263.533C 353.133 266.839 352.339 270.146 352.289 273.452C 349.937 273.047 347.555 272.729 345.145 272.5C 336.305 271.352 327.171 271.747 318.537 273.689C 318.509 273.694 318.48 273.7 318.452 273.705C 318.586 272.474 318.698 271.247 318.779 270.028C 318.997 267.863 318.999 265.698 318.999 263.533L318.999 263.533L318.999 186.733L353.133 186.733zM216.6 16.541L216.6 58.734C 216.6 63.854 220.013 67.267 225.133 67.267C 230.253 67.267 233.666 63.854 233.666 58.734L233.666 58.734L233.666 16.541C 272.259 20.739 301.933 53.088 301.933 92.867L301.933 92.867L259.266 92.867C 254.146 92.867 250.733 96.28 250.733 101.4C 250.733 106.52 254.146 109.933 259.266 109.933L259.266 109.933L301.933 109.933L301.933 144.066L284.866 144.066C 279.746 144.066 276.333 147.479 276.333 152.599C 276.333 157.719 279.746 161.132 284.866 161.132L284.866 161.132L301.933 161.132L301.933 178.2L301.933 195.267L284.866 195.267C 279.746 195.267 276.333 198.68 276.333 203.8C 276.333 208.92 279.746 212.333 284.866 212.333L284.866 212.333L301.933 212.333L301.933 246.466L259.266 246.466C 254.146 246.466 250.733 249.879 250.733 254.999C 250.733 260.119 254.146 263.532 259.266 263.532L259.266 263.532L301.933 263.532C 301.933 268.652 301.08 273.772 300.226 278.892C 295.774 280.821 291.508 283.04 287.445 285.519C 287.336 285.585 287.228 285.651 287.119 285.717C 286.755 285.941 286.393 286.166 286.032 286.394C 285.486 286.737 284.944 287.086 284.405 287.44C 284.369 287.464 284.333 287.487 284.297 287.511C 281.868 289.112 279.52 290.823 277.258 292.637C 263.005 303.993 252.215 319.097 246.466 336.919C 244.976 337.478 243.485 337.942 241.986 338.347C 239.213 338.957 236.44 339.442 233.666 339.781L233.666 339.781L233.666 297.6671C 233.666 292.5471 230.253 289.1341 225.133 289.1341C 220.013 289.1341 216.6 292.5471 216.6 297.6671L216.6 297.6671L216.6 339.86C 178.007 335.662 148.333 303.313 148.333 263.5341L148.333 263.5341L191 263.5341C 196.12 263.5341 199.533 260.1211 199.533 255.0011C 199.533 249.881 196.12 246.468 191 246.468L191 246.468L148.333 246.468L148.333 212.3351L165.4 212.3351C 170.52 212.3351 173.933 208.9221 173.933 203.802C 173.933 198.6821 170.52 195.269 165.4 195.269L165.4 195.269L148.333 195.269L148.333 178.2L148.333 161.133L165.4 161.133C 170.52 161.133 173.933 157.72 173.933 152.6C 173.933 147.48 170.52 144.067 165.4 144.067L165.4 144.067L148.333 144.067L148.333 109.934L191 109.934C 196.12 109.934 199.533 106.521 199.533 101.401C 199.533 96.281 196.12 92.868 191 92.868L191 92.868L148.333 92.868C 148.333 53.088 178.007 20.739 216.6 16.541zM225.133 391.533C 154.306 391.533 97.133 334.36 97.133 263.533L97.133 263.533L97.133 186.733L131.266 186.733L131.266 263.533C 131.266 315.586 173.079 357.4 225.133 357.4C 230.36 357.4 235.808 356.952 241.252 355.949C 241.75 355.879 242.248 355.808 242.746 355.737C 242.618 356.932 242.514 358.133 242.431 359.341C 242.203 361.538 242.2 363.736 242.2 365.933C 242.2 366.808 242.214 367.679 242.237 368.547C 242.249 369.003 242.271 369.465 242.289 369.925C 242.305 370.312 242.32 370.699 242.34 371.084C 242.37 371.66 242.408 372.237 242.449 372.818C 242.468 373.09 242.49 373.361 242.512 373.633C 242.559 374.222 242.608 374.811 242.668 375.402C 243.158 380.351 244.031 385.183 245.252 389.871C 238.546 390.71 231.84 391.533 225.133 391.533zM336.067 442.733C 303.559 442.733 276.023 422.908 264.745 394.601C 264.652 394.15 264.539 393.696 264.387 393.24C 262.265 387.934 260.804 382.298 260.001 376.537C 259.984 376.41 259.97 376.283 259.953 376.156C 259.82 375.166 259.705 374.173 259.611 373.177C 259.565 372.682 259.535 372.182 259.499 371.685C 259.448 371.001 259.391 370.318 259.359 369.632C 259.302 368.406 259.267 367.174 259.267 365.933C 259.267 364.761 259.303 363.598 259.354 362.44C 259.368 362.135 259.381 361.83 259.398 361.527C 259.447 360.638 259.518 359.755 259.597 358.874C 259.989 354.736 260.728 350.697 261.826 346.307C 261.884 346.076 261.914 345.859 261.956 345.636C 263.409 340.251 265.427 335.111 267.945 330.275C 275.73 315.597 288.085 303.575 303.419 296.324C 305.02 295.578 306.654 294.891 308.314 294.254C 309.032 294.254 309.749 294.254 310.467 294.254C 325.827 288.281 342.04 288.281 357.4 292.547C 358.577 292.939 359.572 293.138 360.554 293.087C 391.072 303.227 412.867 331.847 412.867 365.933C 412.867 408.6 378.733 442.733 336.067 442.733z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M378.733 323.267C 375.32 319.854 370.2 319.854 366.786 323.267L366.786 323.267L336.066 353.987L305.346 323.267C 301.933 319.854 296.813 319.854 293.399 323.267C 289.986 326.68 289.986 331.8 293.399 335.214L293.399 335.214L324.119 365.934L294.253 395.8C 290.84 399.213 290.84 404.333 294.253 407.747C 295.96 409.454 297.666 410.307 300.226 410.307C 301.933 410.307 304.493 409.454 306.199 407.747L306.199 407.747L336.066 377.88L365.933 407.747C 367.64 409.454 369.346 410.307 371.906 410.307C 374.466 410.307 377.026 409.454 377.879 407.747C 381.292 404.334 381.292 399.214 377.879 395.8L377.879 395.8L348.012 365.933L378.732 335.213C 382.147 331.8 382.147 326.68 378.733 323.267z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg>');

    }else{

        $('#WAC__mic-button-agent').html('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M182.467 178.2C 182.467 202.093 201.24 220.867 225.134 220.867C 249.027 220.867 267.801 202.094 267.801 178.2C 267.801 154.306 249.028 135.533 225.134 135.533C 201.24 135.533 182.467 154.307 182.467 178.2zM225.133 152.6C 239.64 152.6 250.733 163.693 250.733 178.2C 250.733 192.707 239.64 203.8 225.133 203.8C 210.626 203.8 199.533 192.707 199.533 178.2C 199.533 163.693 210.627 152.6 225.133 152.6z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M369.276 278.06C 369.799 272.861 370.2 268.19 370.2 263.533L370.2 263.533L370.2 178.2C 370.2 173.08 366.787 169.667 361.667 169.667L361.667 169.667L319 169.667L319 92.86699C 319 40.813 277.187 -1 225.133 -1C 173.079 -1 131.266 40.813 131.266 92.867L131.266 92.867L131.266 169.667L88.6 169.667C 83.48 169.667 80.067 173.08 80.067 178.2L80.067 178.2L80.067 263.533C 80.067 340.881 140.372 403.937 216.6 408.344L216.6 408.344L216.6 459.8L173.933 459.8C 150.04 459.8 131.266 478.573 131.266 502.467C 131.266 507.587 134.679 511 139.799 511L139.799 511L310.466 511C 315.586 511 318.999 507.587 318.999 502.467C 318.999 478.574 300.226 459.8 276.332 459.8L276.332 459.8L233.665 459.8L233.665 408.273C 239.55 407.836 245.366 406.968 250.997 405.814C 265.922 437.781 298.295 459.799 336.065 459.799C 388.118 459.799 429.932 417.986 429.932 365.9319C 429.933 325.589 404.812 291.402 369.276 278.06zM277.187 476.867C 288.28 476.867 297.667 483.694 301.08 493.934L301.08 493.934L150.04 493.934C 153.453 483.694 162.84 476.867 173.933 476.867L173.933 476.867L277.187 476.867zM353.133 186.733L353.133 263.533C 353.133 266.839 352.339 270.146 352.289 273.452C 349.937 273.047 347.555 272.729 345.145 272.5C 336.305 271.352 327.171 271.747 318.537 273.689C 318.509 273.694 318.48 273.7 318.452 273.705C 318.586 272.474 318.698 271.247 318.779 270.028C 318.997 267.863 318.999 265.698 318.999 263.533L318.999 263.533L318.999 186.733L353.133 186.733zM216.6 16.541L216.6 58.734C 216.6 63.854 220.013 67.267 225.133 67.267C 230.253 67.267 233.666 63.854 233.666 58.734L233.666 58.734L233.666 16.541C 272.259 20.739 301.933 53.088 301.933 92.867L301.933 92.867L259.266 92.867C 254.146 92.867 250.733 96.28 250.733 101.4C 250.733 106.52 254.146 109.933 259.266 109.933L259.266 109.933L301.933 109.933L301.933 144.066L284.866 144.066C 279.746 144.066 276.333 147.479 276.333 152.599C 276.333 157.719 279.746 161.132 284.866 161.132L284.866 161.132L301.933 161.132L301.933 178.2L301.933 195.267L284.866 195.267C 279.746 195.267 276.333 198.68 276.333 203.8C 276.333 208.92 279.746 212.333 284.866 212.333L284.866 212.333L301.933 212.333L301.933 246.466L259.266 246.466C 254.146 246.466 250.733 249.879 250.733 254.999C 250.733 260.119 254.146 263.532 259.266 263.532L259.266 263.532L301.933 263.532C 301.933 268.652 301.08 273.772 300.226 278.892C 295.774 280.821 291.508 283.04 287.445 285.519C 287.336 285.585 287.228 285.651 287.119 285.717C 286.755 285.941 286.393 286.166 286.032 286.394C 285.486 286.737 284.944 287.086 284.405 287.44C 284.369 287.464 284.333 287.487 284.297 287.511C 281.868 289.112 279.52 290.823 277.258 292.637C 263.005 303.993 252.215 319.097 246.466 336.919C 244.976 337.478 243.485 337.942 241.986 338.347C 239.213 338.957 236.44 339.442 233.666 339.781L233.666 339.781L233.666 297.6671C 233.666 292.5471 230.253 289.1341 225.133 289.1341C 220.013 289.1341 216.6 292.5471 216.6 297.6671L216.6 297.6671L216.6 339.86C 178.007 335.662 148.333 303.313 148.333 263.5341L148.333 263.5341L191 263.5341C 196.12 263.5341 199.533 260.1211 199.533 255.0011C 199.533 249.881 196.12 246.468 191 246.468L191 246.468L148.333 246.468L148.333 212.3351L165.4 212.3351C 170.52 212.3351 173.933 208.9221 173.933 203.802C 173.933 198.6821 170.52 195.269 165.4 195.269L165.4 195.269L148.333 195.269L148.333 178.2L148.333 161.133L165.4 161.133C 170.52 161.133 173.933 157.72 173.933 152.6C 173.933 147.48 170.52 144.067 165.4 144.067L165.4 144.067L148.333 144.067L148.333 109.934L191 109.934C 196.12 109.934 199.533 106.521 199.533 101.401C 199.533 96.281 196.12 92.868 191 92.868L191 92.868L148.333 92.868C 148.333 53.088 178.007 20.739 216.6 16.541zM225.133 391.533C 154.306 391.533 97.133 334.36 97.133 263.533L97.133 263.533L97.133 186.733L131.266 186.733L131.266 263.533C 131.266 315.586 173.079 357.4 225.133 357.4C 230.36 357.4 235.808 356.952 241.252 355.949C 241.75 355.879 242.248 355.808 242.746 355.737C 242.618 356.932 242.514 358.133 242.431 359.341C 242.203 361.538 242.2 363.736 242.2 365.933C 242.2 366.808 242.214 367.679 242.237 368.547C 242.249 369.003 242.271 369.465 242.289 369.925C 242.305 370.312 242.32 370.699 242.34 371.084C 242.37 371.66 242.408 372.237 242.449 372.818C 242.468 373.09 242.49 373.361 242.512 373.633C 242.559 374.222 242.608 374.811 242.668 375.402C 243.158 380.351 244.031 385.183 245.252 389.871C 238.546 390.71 231.84 391.533 225.133 391.533zM336.067 442.733C 303.559 442.733 276.023 422.908 264.745 394.601C 264.652 394.15 264.539 393.696 264.387 393.24C 262.265 387.934 260.804 382.298 260.001 376.537C 259.984 376.41 259.97 376.283 259.953 376.156C 259.82 375.166 259.705 374.173 259.611 373.177C 259.565 372.682 259.535 372.182 259.499 371.685C 259.448 371.001 259.391 370.318 259.359 369.632C 259.302 368.406 259.267 367.174 259.267 365.933C 259.267 364.761 259.303 363.598 259.354 362.44C 259.368 362.135 259.381 361.83 259.398 361.527C 259.447 360.638 259.518 359.755 259.597 358.874C 259.989 354.736 260.728 350.697 261.826 346.307C 261.884 346.076 261.914 345.859 261.956 345.636C 263.409 340.251 265.427 335.111 267.945 330.275C 275.73 315.597 288.085 303.575 303.419 296.324C 305.02 295.578 306.654 294.891 308.314 294.254C 309.032 294.254 309.749 294.254 310.467 294.254C 325.827 288.281 342.04 288.281 357.4 292.547C 358.577 292.939 359.572 293.138 360.554 293.087C 391.072 303.227 412.867 331.847 412.867 365.933C 412.867 408.6 378.733 442.733 336.067 442.733z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M383 324.12C 378.733 321.56 373.613 322.413 371.053 326.68L371.053 326.68L325.656 394.776L299.373 368.493C 295.96 365.08 290.84 365.08 287.426 368.493C 284.012 371.906 284.013 377.026 287.426 380.44L287.426 380.44L319.491 412.505C 320.157 413.648 321.127 414.655 322.413 415.427C 322.507 415.474 322.6 415.52 322.694 415.567C 324.058 416.607 325.535 417.134 327.533 417.134C 330.093 417.134 331.8 416.281 333.506 414.574C 334.63 413.45 335.376 412.139 335.76 410.766L335.76 410.766L385.559 336.067C 388.12 331.8 387.267 326.68 383 324.12z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg>');

 

        stream = WatsonSpeech.SpeechToText.recognizeMicrophone(Object.assign(stttoken, {

            model: fModel("en-US_ShortForm_NarrowbandModel"),

            objectMode: false

        }));

        stream.setEncoding('utf8');

 

        stream.on('data', function(data) {

          $("#WAC__inputContainer-TextArea-agent").val(data);

          reactTriggerChange(document.getElementById("WAC__inputContainer-TextArea-agent"));

          $('#WAC__send-button-agent').trigger("click");

        });

    }

    micon = !micon;

}

 

  function changeColor(color){

      $('.scalebutton').css("background-color",color);

      inst.updateCSSVariables({

        '$interactive-01': color,

        '$focus': color,

        '$link-01': color,

        '$inverse-02': color

      });

 

  }

  function addAudio(){

    if(!$("#WAC__mic-button").length){

        if($('#WAC__inputContainer-TextAreaContainer').length){

            $('#WAC__inputContainer-TextAreaContainer').append('<button class="WAC__button--base WAC__button--primary" id="WAC__mic-button" type="button" aria-label="Click to speak"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M182.467 178.2C 182.467 202.093 201.24 220.867 225.134 220.867C 249.027 220.867 267.801 202.094 267.801 178.2C 267.801 154.306 249.028 135.533 225.134 135.533C 201.24 135.533 182.467 154.307 182.467 178.2zM225.133 152.6C 239.64 152.6 250.733 163.693 250.733 178.2C 250.733 192.707 239.64 203.8 225.133 203.8C 210.626 203.8 199.533 192.707 199.533 178.2C 199.533 163.693 210.627 152.6 225.133 152.6z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M369.276 278.06C 369.799 272.861 370.2 268.19 370.2 263.533L370.2 263.533L370.2 178.2C 370.2 173.08 366.787 169.667 361.667 169.667L361.667 169.667L319 169.667L319 92.86699C 319 40.813 277.187 -1 225.133 -1C 173.079 -1 131.266 40.813 131.266 92.867L131.266 92.867L131.266 169.667L88.6 169.667C 83.48 169.667 80.067 173.08 80.067 178.2L80.067 178.2L80.067 263.533C 80.067 340.881 140.372 403.937 216.6 408.344L216.6 408.344L216.6 459.8L173.933 459.8C 150.04 459.8 131.266 478.573 131.266 502.467C 131.266 507.587 134.679 511 139.799 511L139.799 511L310.466 511C 315.586 511 318.999 507.587 318.999 502.467C 318.999 478.574 300.226 459.8 276.332 459.8L276.332 459.8L233.665 459.8L233.665 408.273C 239.55 407.836 245.366 406.968 250.997 405.814C 265.922 437.781 298.295 459.799 336.065 459.799C 388.118 459.799 429.932 417.986 429.932 365.9319C 429.933 325.589 404.812 291.402 369.276 278.06zM277.187 476.867C 288.28 476.867 297.667 483.694 301.08 493.934L301.08 493.934L150.04 493.934C 153.453 483.694 162.84 476.867 173.933 476.867L173.933 476.867L277.187 476.867zM353.133 186.733L353.133 263.533C 353.133 266.839 352.339 270.146 352.289 273.452C 349.937 273.047 347.555 272.729 345.145 272.5C 336.305 271.352 327.171 271.747 318.537 273.689C 318.509 273.694 318.48 273.7 318.452 273.705C 318.586 272.474 318.698 271.247 318.779 270.028C 318.997 267.863 318.999 265.698 318.999 263.533L318.999 263.533L318.999 186.733L353.133 186.733zM216.6 16.541L216.6 58.734C 216.6 63.854 220.013 67.267 225.133 67.267C 230.253 67.267 233.666 63.854 233.666 58.734L233.666 58.734L233.666 16.541C 272.259 20.739 301.933 53.088 301.933 92.867L301.933 92.867L259.266 92.867C 254.146 92.867 250.733 96.28 250.733 101.4C 250.733 106.52 254.146 109.933 259.266 109.933L259.266 109.933L301.933 109.933L301.933 144.066L284.866 144.066C 279.746 144.066 276.333 147.479 276.333 152.599C 276.333 157.719 279.746 161.132 284.866 161.132L284.866 161.132L301.933 161.132L301.933 178.2L301.933 195.267L284.866 195.267C 279.746 195.267 276.333 198.68 276.333 203.8C 276.333 208.92 279.746 212.333 284.866 212.333L284.866 212.333L301.933 212.333L301.933 246.466L259.266 246.466C 254.146 246.466 250.733 249.879 250.733 254.999C 250.733 260.119 254.146 263.532 259.266 263.532L259.266 263.532L301.933 263.532C 301.933 268.652 301.08 273.772 300.226 278.892C 295.774 280.821 291.508 283.04 287.445 285.519C 287.336 285.585 287.228 285.651 287.119 285.717C 286.755 285.941 286.393 286.166 286.032 286.394C 285.486 286.737 284.944 287.086 284.405 287.44C 284.369 287.464 284.333 287.487 284.297 287.511C 281.868 289.112 279.52 290.823 277.258 292.637C 263.005 303.993 252.215 319.097 246.466 336.919C 244.976 337.478 243.485 337.942 241.986 338.347C 239.213 338.957 236.44 339.442 233.666 339.781L233.666 339.781L233.666 297.6671C 233.666 292.5471 230.253 289.1341 225.133 289.1341C 220.013 289.1341 216.6 292.5471 216.6 297.6671L216.6 297.6671L216.6 339.86C 178.007 335.662 148.333 303.313 148.333 263.5341L148.333 263.5341L191 263.5341C 196.12 263.5341 199.533 260.1211 199.533 255.0011C 199.533 249.881 196.12 246.468 191 246.468L191 246.468L148.333 246.468L148.333 212.3351L165.4 212.3351C 170.52 212.3351 173.933 208.9221 173.933 203.802C 173.933 198.6821 170.52 195.269 165.4 195.269L165.4 195.269L148.333 195.269L148.333 178.2L148.333 161.133L165.4 161.133C 170.52 161.133 173.933 157.72 173.933 152.6C 173.933 147.48 170.52 144.067 165.4 144.067L165.4 144.067L148.333 144.067L148.333 109.934L191 109.934C 196.12 109.934 199.533 106.521 199.533 101.401C 199.533 96.281 196.12 92.868 191 92.868L191 92.868L148.333 92.868C 148.333 53.088 178.007 20.739 216.6 16.541zM225.133 391.533C 154.306 391.533 97.133 334.36 97.133 263.533L97.133 263.533L97.133 186.733L131.266 186.733L131.266 263.533C 131.266 315.586 173.079 357.4 225.133 357.4C 230.36 357.4 235.808 356.952 241.252 355.949C 241.75 355.879 242.248 355.808 242.746 355.737C 242.618 356.932 242.514 358.133 242.431 359.341C 242.203 361.538 242.2 363.736 242.2 365.933C 242.2 366.808 242.214 367.679 242.237 368.547C 242.249 369.003 242.271 369.465 242.289 369.925C 242.305 370.312 242.32 370.699 242.34 371.084C 242.37 371.66 242.408 372.237 242.449 372.818C 242.468 373.09 242.49 373.361 242.512 373.633C 242.559 374.222 242.608 374.811 242.668 375.402C 243.158 380.351 244.031 385.183 245.252 389.871C 238.546 390.71 231.84 391.533 225.133 391.533zM336.067 442.733C 303.559 442.733 276.023 422.908 264.745 394.601C 264.652 394.15 264.539 393.696 264.387 393.24C 262.265 387.934 260.804 382.298 260.001 376.537C 259.984 376.41 259.97 376.283 259.953 376.156C 259.82 375.166 259.705 374.173 259.611 373.177C 259.565 372.682 259.535 372.182 259.499 371.685C 259.448 371.001 259.391 370.318 259.359 369.632C 259.302 368.406 259.267 367.174 259.267 365.933C 259.267 364.761 259.303 363.598 259.354 362.44C 259.368 362.135 259.381 361.83 259.398 361.527C 259.447 360.638 259.518 359.755 259.597 358.874C 259.989 354.736 260.728 350.697 261.826 346.307C 261.884 346.076 261.914 345.859 261.956 345.636C 263.409 340.251 265.427 335.111 267.945 330.275C 275.73 315.597 288.085 303.575 303.419 296.324C 305.02 295.578 306.654 294.891 308.314 294.254C 309.032 294.254 309.749 294.254 310.467 294.254C 325.827 288.281 342.04 288.281 357.4 292.547C 358.577 292.939 359.572 293.138 360.554 293.087C 391.072 303.227 412.867 331.847 412.867 365.933C 412.867 408.6 378.733 442.733 336.067 442.733z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M378.733 323.267C 375.32 319.854 370.2 319.854 366.786 323.267L366.786 323.267L336.066 353.987L305.346 323.267C 301.933 319.854 296.813 319.854 293.399 323.267C 289.986 326.68 289.986 331.8 293.399 335.214L293.399 335.214L324.119 365.934L294.253 395.8C 290.84 399.213 290.84 404.333 294.253 407.747C 295.96 409.454 297.666 410.307 300.226 410.307C 301.933 410.307 304.493 409.454 306.199 407.747L306.199 407.747L336.066 377.88L365.933 407.747C 367.64 409.454 369.346 410.307 371.906 410.307C 374.466 410.307 377.026 409.454 377.879 407.747C 381.292 404.334 381.292 399.214 377.879 395.8L377.879 395.8L348.012 365.933L378.732 335.213C 382.147 331.8 382.147 326.68 378.733 323.267z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg></button>');

            $('#WAC__inputContainer-TextAreaContainer').append('<button class="WAC__button--base WAC__button--primary" id="WAC__speaker-button" type="button" aria-label="Click to hear"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(2.06405 0 0 2.06405 128 0)"  d="M339.642 235.684L288.842 184.484L339.642 133.684C 342.842 130.484 342.842 125.684 339.642 122.484C 336.442 119.284 331.642 119.284 328.442 122.484L328.442 122.484L277.642 173.284L226.442 122.484C 223.242 119.284 218.442 119.284 215.242 122.484C 212.042 125.684 212.042 130.484 215.242 133.684L215.242 133.684L266.042 184.484L215.242 235.684C 212.042 238.884 212.042 243.684 215.242 246.884C 216.842 248.484 218.842 249.284 220.842 249.284C 222.842 249.284 224.842 248.484 226.442 246.884L226.442 246.884L277.642 196.084L328.442 246.884C 330.042 248.484 332.042 249.284 334.042 249.284C 336.042 249.284 338.042 248.484 339.642 246.884C 342.842 243.684 342.842 238.884 339.642 235.684z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(2.06405 0 0 2.06405 128 0)"  d="M278.042 232.084C 273.642 232.084 270.042 235.684 270.042 240.084L270.042 240.084L270.042 356.084L142.042 259.284C 141.642 255.284 138.442 252.084 134.042 252.084C 129.642 252.084 126.042 255.684 126.042 260.084C 126.042 264.484 122.442 268.084 118.042 268.084L118.042 268.084L70.04199 268.084C 56.84199 268.084 46.04199 257.284 46.04199 244.084L46.04199 244.084L46.04199 132.084C 46.04199 118.884 56.84199 108.084 70.04199 108.084L70.04199 108.084L118.042 108.084C 122.442 108.084 126.042 111.684 126.042 116.084C 126.042 120.484 129.642 124.084 134.042 124.084C 138.442 124.084 142.042 120.484 142.042 116.084C 142.042 115.284 142.042 114.084 142.042 113.284L142.042 113.284L270.042 16.08398L270.042 136.084C 270.042 140.484 273.642 144.084 278.042 144.084C 282.442 144.084 286.042 140.484 286.042 136.084L286.042 136.084L286.042 16.08398C 286.042 10.08398 282.442 4.483984 277.242 1.683985C 271.642 -1.116015 265.242 -0.3160152 260.442 3.283985L260.442 3.283985L134.442 98.88398C 130.042 94.88398 124.442 92.08398 118.042 92.08398L118.042 92.08398L70.04202 92.08398C 48.04202 92.08398 30.04202 110.084 30.04202 132.084L30.04202 132.084L30.04202 244.084C 30.04202 266.084 48.04202 284.084 70.04202 284.084L70.04202 284.084L118.042 284.084C 125.642 284.084 132.042 280.884 136.442 275.284L136.442 275.284L260.442 368.884C 263.242 371.284 266.842 372.084 270.042 372.084C 272.442 372.084 274.842 371.684 277.242 370.484C 282.842 367.684 286.042 362.084 286.042 356.084L286.042 356.084L286.042 240.084C 286.042 235.684 282.442 232.084 278.042 232.084z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg></button>');

            $('#WAC__mic-button').click(michandler);

            $('#WAC__speaker-button').click(speakerhandler);

            clearInterval(audioicons);

        }

    }

  }

  function addAudioAgent(){

    if(!$("#WAC__mic-button-agent").length){

        if($('#WAC__inputContainer-TextAreaContainer-agent').length){

            $('#WAC__inputContainer-TextAreaContainer-agent').append('<button class="WAC__button--base WAC__button--primary" id="WAC__mic-button-agent" type="button" aria-label="Click to speak"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M182.467 178.2C 182.467 202.093 201.24 220.867 225.134 220.867C 249.027 220.867 267.801 202.094 267.801 178.2C 267.801 154.306 249.028 135.533 225.134 135.533C 201.24 135.533 182.467 154.307 182.467 178.2zM225.133 152.6C 239.64 152.6 250.733 163.693 250.733 178.2C 250.733 192.707 239.64 203.8 225.133 203.8C 210.626 203.8 199.533 192.707 199.533 178.2C 199.533 163.693 210.627 152.6 225.133 152.6z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M369.276 278.06C 369.799 272.861 370.2 268.19 370.2 263.533L370.2 263.533L370.2 178.2C 370.2 173.08 366.787 169.667 361.667 169.667L361.667 169.667L319 169.667L319 92.86699C 319 40.813 277.187 -1 225.133 -1C 173.079 -1 131.266 40.813 131.266 92.867L131.266 92.867L131.266 169.667L88.6 169.667C 83.48 169.667 80.067 173.08 80.067 178.2L80.067 178.2L80.067 263.533C 80.067 340.881 140.372 403.937 216.6 408.344L216.6 408.344L216.6 459.8L173.933 459.8C 150.04 459.8 131.266 478.573 131.266 502.467C 131.266 507.587 134.679 511 139.799 511L139.799 511L310.466 511C 315.586 511 318.999 507.587 318.999 502.467C 318.999 478.574 300.226 459.8 276.332 459.8L276.332 459.8L233.665 459.8L233.665 408.273C 239.55 407.836 245.366 406.968 250.997 405.814C 265.922 437.781 298.295 459.799 336.065 459.799C 388.118 459.799 429.932 417.986 429.932 365.9319C 429.933 325.589 404.812 291.402 369.276 278.06zM277.187 476.867C 288.28 476.867 297.667 483.694 301.08 493.934L301.08 493.934L150.04 493.934C 153.453 483.694 162.84 476.867 173.933 476.867L173.933 476.867L277.187 476.867zM353.133 186.733L353.133 263.533C 353.133 266.839 352.339 270.146 352.289 273.452C 349.937 273.047 347.555 272.729 345.145 272.5C 336.305 271.352 327.171 271.747 318.537 273.689C 318.509 273.694 318.48 273.7 318.452 273.705C 318.586 272.474 318.698 271.247 318.779 270.028C 318.997 267.863 318.999 265.698 318.999 263.533L318.999 263.533L318.999 186.733L353.133 186.733zM216.6 16.541L216.6 58.734C 216.6 63.854 220.013 67.267 225.133 67.267C 230.253 67.267 233.666 63.854 233.666 58.734L233.666 58.734L233.666 16.541C 272.259 20.739 301.933 53.088 301.933 92.867L301.933 92.867L259.266 92.867C 254.146 92.867 250.733 96.28 250.733 101.4C 250.733 106.52 254.146 109.933 259.266 109.933L259.266 109.933L301.933 109.933L301.933 144.066L284.866 144.066C 279.746 144.066 276.333 147.479 276.333 152.599C 276.333 157.719 279.746 161.132 284.866 161.132L284.866 161.132L301.933 161.132L301.933 178.2L301.933 195.267L284.866 195.267C 279.746 195.267 276.333 198.68 276.333 203.8C 276.333 208.92 279.746 212.333 284.866 212.333L284.866 212.333L301.933 212.333L301.933 246.466L259.266 246.466C 254.146 246.466 250.733 249.879 250.733 254.999C 250.733 260.119 254.146 263.532 259.266 263.532L259.266 263.532L301.933 263.532C 301.933 268.652 301.08 273.772 300.226 278.892C 295.774 280.821 291.508 283.04 287.445 285.519C 287.336 285.585 287.228 285.651 287.119 285.717C 286.755 285.941 286.393 286.166 286.032 286.394C 285.486 286.737 284.944 287.086 284.405 287.44C 284.369 287.464 284.333 287.487 284.297 287.511C 281.868 289.112 279.52 290.823 277.258 292.637C 263.005 303.993 252.215 319.097 246.466 336.919C 244.976 337.478 243.485 337.942 241.986 338.347C 239.213 338.957 236.44 339.442 233.666 339.781L233.666 339.781L233.666 297.6671C 233.666 292.5471 230.253 289.1341 225.133 289.1341C 220.013 289.1341 216.6 292.5471 216.6 297.6671L216.6 297.6671L216.6 339.86C 178.007 335.662 148.333 303.313 148.333 263.5341L148.333 263.5341L191 263.5341C 196.12 263.5341 199.533 260.1211 199.533 255.0011C 199.533 249.881 196.12 246.468 191 246.468L191 246.468L148.333 246.468L148.333 212.3351L165.4 212.3351C 170.52 212.3351 173.933 208.9221 173.933 203.802C 173.933 198.6821 170.52 195.269 165.4 195.269L165.4 195.269L148.333 195.269L148.333 178.2L148.333 161.133L165.4 161.133C 170.52 161.133 173.933 157.72 173.933 152.6C 173.933 147.48 170.52 144.067 165.4 144.067L165.4 144.067L148.333 144.067L148.333 109.934L191 109.934C 196.12 109.934 199.533 106.521 199.533 101.401C 199.533 96.281 196.12 92.868 191 92.868L191 92.868L148.333 92.868C 148.333 53.088 178.007 20.739 216.6 16.541zM225.133 391.533C 154.306 391.533 97.133 334.36 97.133 263.533L97.133 263.533L97.133 186.733L131.266 186.733L131.266 263.533C 131.266 315.586 173.079 357.4 225.133 357.4C 230.36 357.4 235.808 356.952 241.252 355.949C 241.75 355.879 242.248 355.808 242.746 355.737C 242.618 356.932 242.514 358.133 242.431 359.341C 242.203 361.538 242.2 363.736 242.2 365.933C 242.2 366.808 242.214 367.679 242.237 368.547C 242.249 369.003 242.271 369.465 242.289 369.925C 242.305 370.312 242.32 370.699 242.34 371.084C 242.37 371.66 242.408 372.237 242.449 372.818C 242.468 373.09 242.49 373.361 242.512 373.633C 242.559 374.222 242.608 374.811 242.668 375.402C 243.158 380.351 244.031 385.183 245.252 389.871C 238.546 390.71 231.84 391.533 225.133 391.533zM336.067 442.733C 303.559 442.733 276.023 422.908 264.745 394.601C 264.652 394.15 264.539 393.696 264.387 393.24C 262.265 387.934 260.804 382.298 260.001 376.537C 259.984 376.41 259.97 376.283 259.953 376.156C 259.82 375.166 259.705 374.173 259.611 373.177C 259.565 372.682 259.535 372.182 259.499 371.685C 259.448 371.001 259.391 370.318 259.359 369.632C 259.302 368.406 259.267 367.174 259.267 365.933C 259.267 364.761 259.303 363.598 259.354 362.44C 259.368 362.135 259.381 361.83 259.398 361.527C 259.447 360.638 259.518 359.755 259.597 358.874C 259.989 354.736 260.728 350.697 261.826 346.307C 261.884 346.076 261.914 345.859 261.956 345.636C 263.409 340.251 265.427 335.111 267.945 330.275C 275.73 315.597 288.085 303.575 303.419 296.324C 305.02 295.578 306.654 294.891 308.314 294.254C 309.032 294.254 309.749 294.254 310.467 294.254C 325.827 288.281 342.04 288.281 357.4 292.547C 358.577 292.939 359.572 293.138 360.554 293.087C 391.072 303.227 412.867 331.847 412.867 365.933C 412.867 408.6 378.733 442.733 336.067 442.733z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(1.5 0 0 1.5 129.5 1.5)"  d="M378.733 323.267C 375.32 319.854 370.2 319.854 366.786 323.267L366.786 323.267L336.066 353.987L305.346 323.267C 301.933 319.854 296.813 319.854 293.399 323.267C 289.986 326.68 289.986 331.8 293.399 335.214L293.399 335.214L324.119 365.934L294.253 395.8C 290.84 399.213 290.84 404.333 294.253 407.747C 295.96 409.454 297.666 410.307 300.226 410.307C 301.933 410.307 304.493 409.454 306.199 407.747L306.199 407.747L336.066 377.88L365.933 407.747C 367.64 409.454 369.346 410.307 371.906 410.307C 374.466 410.307 377.026 409.454 377.879 407.747C 381.292 404.334 381.292 399.214 377.879 395.8L377.879 395.8L348.012 365.933L378.732 335.213C 382.147 331.8 382.147 326.68 378.733 323.267z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg></button>');

            $('#WAC__inputContainer-TextAreaContainer-agent').append('<button class="WAC__button--base WAC__button--primary" id="WAC__speaker-button-agent" type="button" aria-label="Click to hear"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="24"> <g transform="matrix(0.03125 0 0 0.03125 0 0)"> <path transform="matrix(2.06405 0 0 2.06405 128 0)"  d="M339.642 235.684L288.842 184.484L339.642 133.684C 342.842 130.484 342.842 125.684 339.642 122.484C 336.442 119.284 331.642 119.284 328.442 122.484L328.442 122.484L277.642 173.284L226.442 122.484C 223.242 119.284 218.442 119.284 215.242 122.484C 212.042 125.684 212.042 130.484 215.242 133.684L215.242 133.684L266.042 184.484L215.242 235.684C 212.042 238.884 212.042 243.684 215.242 246.884C 216.842 248.484 218.842 249.284 220.842 249.284C 222.842 249.284 224.842 248.484 226.442 246.884L226.442 246.884L277.642 196.084L328.442 246.884C 330.042 248.484 332.042 249.284 334.042 249.284C 336.042 249.284 338.042 248.484 339.642 246.884C 342.842 243.684 342.842 238.884 339.642 235.684z" stroke="none" fill="white" fill-rule="nonzero" /> <path transform="matrix(2.06405 0 0 2.06405 128 0)"  d="M278.042 232.084C 273.642 232.084 270.042 235.684 270.042 240.084L270.042 240.084L270.042 356.084L142.042 259.284C 141.642 255.284 138.442 252.084 134.042 252.084C 129.642 252.084 126.042 255.684 126.042 260.084C 126.042 264.484 122.442 268.084 118.042 268.084L118.042 268.084L70.04199 268.084C 56.84199 268.084 46.04199 257.284 46.04199 244.084L46.04199 244.084L46.04199 132.084C 46.04199 118.884 56.84199 108.084 70.04199 108.084L70.04199 108.084L118.042 108.084C 122.442 108.084 126.042 111.684 126.042 116.084C 126.042 120.484 129.642 124.084 134.042 124.084C 138.442 124.084 142.042 120.484 142.042 116.084C 142.042 115.284 142.042 114.084 142.042 113.284L142.042 113.284L270.042 16.08398L270.042 136.084C 270.042 140.484 273.642 144.084 278.042 144.084C 282.442 144.084 286.042 140.484 286.042 136.084L286.042 136.084L286.042 16.08398C 286.042 10.08398 282.442 4.483984 277.242 1.683985C 271.642 -1.116015 265.242 -0.3160152 260.442 3.283985L260.442 3.283985L134.442 98.88398C 130.042 94.88398 124.442 92.08398 118.042 92.08398L118.042 92.08398L70.04202 92.08398C 48.04202 92.08398 30.04202 110.084 30.04202 132.084L30.04202 132.084L30.04202 244.084C 30.04202 266.084 48.04202 284.084 70.04202 284.084L70.04202 284.084L118.042 284.084C 125.642 284.084 132.042 280.884 136.442 275.284L136.442 275.284L260.442 368.884C 263.242 371.284 266.842 372.084 270.042 372.084C 272.442 372.084 274.842 371.684 277.242 370.484C 282.842 367.684 286.042 362.084 286.042 356.084L286.042 356.084L286.042 240.084C 286.042 235.684 282.442 232.084 278.042 232.084z" stroke="none" fill="white" fill-rule="nonzero" /> </g> </svg></button>');

            $('#WAC__mic-button-agent').click(michandlerAgent);

            $('#WAC__speaker-button-agent').click(speakerhandler);

            clearInterval(audioicons);

        }

    }

  }

  function speakOut(event){

    if (speakeron){

        var element = [];

        element.text = event;

        element.lvoice = fLang("en-US_EmilyV3Voice");

        sayQueue.push(element);

    }

  }

  function botSpeakOut(event){

    var lvoice = false;

    if (speakeron){

        event.data.output.entities.forEach(element => ((element.entity == "en-US_EmilyV3Voice") ? lvoice = element.value : 1));

        if(lvoice)

            lvoice = Object.keys(lang).find(key => lang[key] === lvoice);

        else

            lvoice = fLang("en-US_EmilyV3Voice");

 

        event.data.output.generic.forEach(element => {

            element.lvoice = lvoice;

            if(!element.text){

                if(element.header)

                    element.text = element.header;

                else

                    return;

            }

            sayQueue.push(element);

        } );

    }

  }

  function handleMapTemplate(event) {

      const element = document.createElement('div');

      element.setAttribute('class', 'customClass');

      element.innerHTML = event.data.message.user_defined.text ;

      event.data.element.appendChild(element);

    }

  function handleUpsellTemplate(event) {

      const element = document.createElement('div');

      element.setAttribute('class', 'customClass');

      element.innerHTML = '<div class="card"><div class="card-body"><h5 class="card-title">Your Offer</h5><p id="upsell" class="card-text">' + event.data.message.user_defined.text + '</p></div></div>' ;

      event.data.element.appendChild(element);

    }

     function handlePasswordTemplate(event) {

      const element = document.createElement('div');

      element.setAttribute('class', 'customClass');

      element.innerHTML = '<div class="card"><div class="card-body"><h5 class="card-title">Choose a new password</h5><div id="password" class="card-text"><input type="password" class="form-control" id="rPassword" placeholder="Enter a new password"/><br><br><button type="submit" class="btn btn-primary" onclick="passwordGreen()">Submit</button></div></div></div>' ;

      event.data.element.appendChild(element);

    }

    function passwordGreen(){

        $("#rPassword").css("border-color","green");

    }

  function customResponseHandler(event) {

    const { message } = event.data;

 

    switch (message.user_defined.template_name) {

      case 'upsell':

        handleUpsellTemplate(event);

        break;

      case 'map':

        handleMapTemplate(event);

        break;

      case 'password':

        handlePasswordTemplate(event);

        break;

      default:

        console.error('Unhandled response type.');

    }

  }

 

  window.watsonAssistantChatOptions = {

    integrationID: "01048175-56ea-4e67-b6a9-a6538b2b0c3b", // The ID of this integration.
    region: "us-south", // The region your integration is hosted in.
    serviceInstanceID: "b9e1baf2-2cdc-4866-828b-391f0d7a2818", // The ID of your service instance.
    openChatByDefault: "false",
    hideCloseButton: "true",

    showLauncher: false,

    serviceDeskFactory: window.WebChatServiceDeskFactory,

    onLoad: function(instance) {

        inst = instance;

 

        instance.on({ type: 'customResponse', handler: customResponseHandler });

        inst.render();

        instance.on({ type: "pre:send", handler: function(event){

            $.post( "/userCollect", event );

        }});

        instance.on({ type: "pre:receive", handler: function(event){

            $.post( "/botCollect", event );

            botSpeakOut(event);

            } });

        audioicons = setInterval(addAudio, 100);

        $('#bwrap').draggable({

            start: function( event, ui ) {

                freezeClick = true;

            },

            stop: function( event, ui ) {

                Cookies.set('position', JSON.stringify($("#bwrap").position()), { expires: 17 });

                setTimeout(function(){freezeClick = false}, 500);

            }

        })

        $('.scalebutton').resizable({

            alsoResize: ".scalebutton",

            start: function( event, ui ) {

                freezeClick = true;

            },

            stop: function( event, ui ) {

                Cookies.set('height', $("#wbutton").height(), { expires: 17 });

                Cookies.set('width', $("#wbutton").width(), { expires: 17 });

                setTimeout(function(){freezeClick = false}, 500);

            }

        });

        $('#bwrap').css('display','table');

        $('#wbutton').click(function() {

            if (!freezeClick)

                instance.openWindow();

        });

        $('#sbutton').click(function() {

            var searchModal = new bootstrap.Modal(document.getElementById('searchModal'), {

              keyboard: false

            });

            if (!freezeClick)

                searchModal.show();

        });

        var bcolor = Cookies.get('color');

        var bwidth = Cookies.get('width');

        var bheight = Cookies.get('height');

        var position = Cookies.get('position');

 

        if(bcolor)

            changeColor(bcolor);

        if(position)

            $("#bwrap").css(JSON.parse(position));

        if(bwidth)

            $(".scalebutton").width(bwidth);

        if(bheight)

            $(".scalebutton").height(bheight);

 

    }

    };

  setTimeout(function(){

    const t=document.createElement('script');

    t.src="https://web-chat.global.assistant.watson.appdomain.cloud/loadWatsonAssistantChat.js";

    document.head.appendChild(t);

  });

  $('#dcolor').change(function(){

      changeColor(this.value);

      Cookies.set('color', this.value, { expires: 17 })

  });

  $('#startdemo').click(function(){

      $('#warningbanner').hide();

      $('body').css({"background-image": "url('site.png')", "background-size": "cover", "background-repeat":   "no-repeat"})

  });

  $(':file').on('change', function () {

      var fd = new FormData();

        var files = $('#file')[0].files;

        if(files.length > 0 ){

              fd.append('file',files[0]);

              $.ajax({

                url: '/upScreen',

                type: 'POST',

                data: fd,

                contentType: false,

                processData: false,

                success: function(response){

                 if(response != 0){

                    location.reload();

                 }

              },

              });

        }

    });